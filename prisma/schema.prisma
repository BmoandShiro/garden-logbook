generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String            @id @default(cuid())
  name              String?
  email             String            @unique
  emailVerified     DateTime?
  image             String?
  role              Role              @default(USER)
  permissions       Permission[]
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  password          String?
  username          String?           @unique
  accounts          Account[]
  createdSOPs       CleaningSOP[]
  createdEquipment  Equipment[]
  ownedGardens      Garden[]          @relation("GardenCreator")
  addedMembers      GardenMember[]    @relation("MemberAdder")
  gardenMemberships GardenMember[]
  logs              Log[]
  logEntries        LogEntry[]
  logTemplates      LogTemplate[]
  createdTasks      MaintenanceTask[]
  plants            Plant[]
  createdRooms      Room[]            @relation("RoomCreator")
  roomTemplates     RoomTemplate[]
  sessions          Session[]
  strains           Strain[]
  createdZones      Zone[]
  seeds             Seed[]
  calendarNotes     CalendarNote[]
  notifications     Notification[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Plant {
  id          String     @id @default(cuid())
  name        String
  strainName  String?
  strainId    String?
  species     String?
  variety     String?
  stage       Stage      @default(VEGETATIVE)
  location    String?
  startDate   DateTime   @default(now())
  harvestDate DateTime?
  notes       String?
  imageUrl    String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  userId      String
  roomId      String?
  gardenId    String?
  type        PlantType  @default(REGULAR)
  zoneId      String?
  logs        Log[]
  garden      Garden?    @relation(fields: [gardenId], references: [id], onDelete: Cascade)
  room        Room?      @relation(fields: [roomId], references: [id])
  strain      Strain?    @relation(fields: [strainId], references: [id])
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  zone        Zone?      @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  logEntries  LogEntry[] @relation("LogEntryToPlant")
  tags        Tag[]      @relation("PlantToTag")
  growingSeasonStart            String?
  growingSeasonEnd              String?
  onlyTriggerAlertsDuringSeason Boolean   @default(false)
  sensitivities                 Json?
}

model Strain {
  id            String   @id @default(cuid())
  name          String
  type          String?
  floweringTime Int?
  description   String?
  imageUrl      String?
  thcContent    Float?
  cbdContent    Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  userId        String
  plants        Plant[]
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MeasurementUnit {
  id         String   @id @default(cuid())
  name       String
  symbol     String
  type       String
  conversion Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  fields     Field[]
}

model Field {
  id           String           @id @default(cuid())
  name         String
  key          String
  description  String?
  type         MeasurementType
  required     Boolean          @default(false)
  defaultValue String?
  unitId       String?
  options      Json?
  validation   Json?
  category     String
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  logType      LogType?
  order        Int              @default(0)
  active       Boolean          @default(true)
  unit         MeasurementUnit? @relation(fields: [unitId], references: [id])
}

model Log {
  id           String     @id @default(cuid())
  type         LogType
  stage        Stage
  temperature  Float?
  humidity     Float?
  waterAmount  Float?
  notes        String?
  plantId      String?
  userId       String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  co2          Float?
  gardenId     String?
  healthRating Int?
  height       Float?
  imageUrls    String[]
  nodeCount    Int?
  roomId       String?
  vpd          Float?
  width        Float?
  zoneId       String?
  ppfd         Float?
  runoffPh     Float?
  waterPh      Float?
  boosterPpm   Float?
  data         Json?
  finishPpm    Float?
  logDate      DateTime
  partAPpm     Float?
  partBPpm     Float?
  partCPpm     Float?
  runoffPpm    Float?
  waterPpm     Float?
  waterTemp    Float?

  // Watering-specific fields
  waterSource           String?
  waterUnit            String?
  waterTemperature     Float?
  waterTemperatureUnit String?
  sourceWaterPh        Float?
  nutrientWaterPh      Float?
  sourceWaterPpm       Float?
  nutrientWaterPpm     Float?
  ppmScale             String?
  nutrientLine         String?
  jacks321Used         String[]
  jacks321Unit         String?
  partAAmount          Float?
  partBAmount          Float?
  partCAmount          Float?
  boosterAmount        Float?
  finishAmount         Float?
  customNutrients      Json?
  sourceWaterTemperature Float?
  sourceWaterTemperatureUnit String?
  nutrientWaterTemperature Float?
  nutrientWaterTemperatureUnit String?

  // Relations
  garden       Garden?    @relation(fields: [gardenId], references: [id])
  plant        Plant?     @relation(fields: [plantId], references: [id])
  room         Room?      @relation(fields: [roomId], references: [id])
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  zone         Zone?      @relation(fields: [zoneId], references: [id])

  @@index([userId])
  @@index([logDate])
  @@index([type])
}

model Tag {
  id        String   @id @default(cuid())
  name      String   @unique
  color     String?
  createdAt DateTime @default(now())
  plants    Plant[]  @relation("PlantToTag")
}

model LogTemplate {
  id             String     @id @default(cuid())
  name           String
  description    String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  userId         String
  roomId         String?
  fields         Json
  isActive       Boolean    @default(true)
  color          String?
  defaultValues  Json?
  gardenId       String?
  icon           String?
  isPublic       Boolean    @default(false)
  layout         Json?
  reminderBefore Int?
  reminders      Boolean    @default(false)
  required       String[]
  scheduleConfig Json?
  type           LogType
  version        Int        @default(1)
  entries        LogEntry[]
  garden         Garden?    @relation(fields: [gardenId], references: [id])
  room           Room?      @relation(fields: [roomId], references: [id])
  createdBy      User       @relation(fields: [userId], references: [id])
}

model LogEntry {
  id           String      @id @default(cuid())
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  date         DateTime
  templateId   String
  userId       String
  roomId       String?
  data         Json
  notes        String?
  completedAt  DateTime?
  duration     Int?
  gardenId     String?
  imageUrls    String[]
  scheduledFor DateTime?
  status       String      @default("completed")
  tags         String[]
  weather      Json?
  zoneId       String?
  garden       Garden?     @relation(fields: [gardenId], references: [id])
  room         Room?       @relation(fields: [roomId], references: [id])
  template     LogTemplate @relation(fields: [templateId], references: [id])
  createdBy    User        @relation(fields: [userId], references: [id])
  zone         Zone?       @relation(fields: [zoneId], references: [id])
  plants       Plant[]     @relation("LogEntryToPlant")
}

model Room {
  id               String            @id @default(cuid())
  name             String
  description      String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  gardenId         String
  blueprintUrl     String?
  dimensions       String?
  type             String?
  creatorId        String
  cleaningSOPs     CleaningSOP[]
  equipment        Equipment[]
  logs             Log[]
  logEntries       LogEntry[]
  logTemplates     LogTemplate[]
  maintenanceTasks MaintenanceTask[]
  plants           Plant[]
  createdBy        User              @relation("RoomCreator", fields: [creatorId], references: [id])
  garden           Garden            @relation(fields: [gardenId], references: [id], onDelete: Cascade)
  zones            Zone[]
  calendarNotes    CalendarNote[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Garden {
  id           String         @id @default(cuid())
  name         String
  description  String?
  isPrivate    Boolean        @default(true)
  imageUrl     String?
  zipcode      String?        // US Zipcode
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  creatorId    String
  createdBy    User           @relation("GardenCreator", fields: [creatorId], references: [id])
  members      GardenMember[]
  logs         Log[]
  logEntries   LogEntry[]
  logTemplates LogTemplate[]
  plants       Plant[]
  rooms        Room[]
  gardenInvites GardenInvite[]
  calendarNotes CalendarNote[]
  weatherStatus Json?
}

model GardenMember {
  id          String               @id @default(cuid())
  gardenId    String
  userId      String
  permissions ResourcePermission[]
  addedById   String
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  addedBy     User                 @relation("MemberAdder", fields: [addedById], references: [id])
  garden      Garden               @relation(fields: [gardenId], references: [id], onDelete: Cascade)
  user        User                 @relation(fields: [userId], references: [id])

  @@unique([gardenId, userId])
}

model Equipment {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  roomId      String
  creatorId   String
  createdBy   User     @relation(fields: [creatorId], references: [id])
  room        Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model CleaningSOP {
  id          String   @id @default(cuid())
  title       String
  description String?
  frequency   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  roomId      String
  creatorId   String
  createdBy   User     @relation(fields: [creatorId], references: [id])
  room        Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model MaintenanceTask {
  id          String   @id @default(cuid())
  title       String
  description String?
  frequency   String
  nextDueDate DateTime
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  roomId      String
  creatorId   String
  createdBy   User     @relation(fields: [creatorId], references: [id])
  room        Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model RoomTemplate {
  id                 String   @id @default(cuid())
  name               String
  description        String?
  type               String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  userId             String
  defaultEquipment   Json
  defaultSOPs        Json
  defaultMaintenance Json
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Zone {
  id          String      @id @default(cuid())
  name        String
  description String?
  type        String?
  dimensions  String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  roomId      String
  creatorId   String
  logs        Log[]
  logEntries  LogEntry[]
  plants      Plant[]
  createdBy   User        @relation(fields: [creatorId], references: [id])
  room        Room        @relation(fields: [roomId], references: [id], onDelete: Cascade)
  calendarNotes CalendarNote[]
}

model Seed {
  id            String    @id @default(cuid())
  variety       String
  strain        String
  batch         String
  breeder       String
  quantity      Int
  dateAcquired  DateTime
  dateHarvested DateTime?
  feminized     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  userId        String
  createdBy     User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model GardenInvite {
  id        String   @id @default(cuid())
  gardenId  String
  email     String
  invitedAt DateTime @default(now())
  accepted  Boolean  @default(false)

  garden    Garden   @relation(fields: [gardenId], references: [id], onDelete: Cascade)

  @@unique([gardenId, email])
}

model CalendarNote {
  id        String   @id @default(cuid())
  date      String
  note      String
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  garden    Garden?  @relation(fields: [gardenId], references: [id])
  gardenId  String?
  room      Room?    @relation(fields: [roomId], references: [id])
  roomId    String?
  zone      Zone?    @relation(fields: [zoneId], references: [id])
  zoneId    String?
  private   Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  meta      Json?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
}

model GardenLogVisibilityPreference {
  id        String   @id @default(cuid())
  userId    String
  gardenId  String
  showLogs  Boolean  @default(true)
  @@unique([userId, gardenId])
}

model WeatherCheck {
  id           String   @id @default(cuid())
  zip          String   @unique
  lastChecked  DateTime
  data         Json?
}

enum Role {
  ADMIN
  USER
  MODERATOR
}

enum Permission {
  CREATE_PLANT
  EDIT_PLANT
  DELETE_PLANT
  CREATE_LOG
  EDIT_LOG
  DELETE_LOG
  MANAGE_USERS
  MANAGE_ROLES
  MANAGE_STRAINS
}

enum ResourcePermission {
  VIEW
  EDIT
  DELETE
  MANAGE
  INVITE
  MANAGE_PERMS
}

enum ScheduleFrequency {
  HOURLY
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  BIANNUAL
  YEARLY
  CUSTOM
}

enum PlantType {
  REGULAR
  ZONE_PLANT
}

enum MeasurementType {
  NUMBER
  TEXT
  BOOLEAN
  DATE
  TIME
  DATETIME
  ENUM
  MULTI_ENUM
}

enum LogType {
  WATERING
  ENVIRONMENTAL
  LST
  HST
  HARVEST
  DRYING
  PEST_STRESS_DISEASE
  PEST_DISEASE
  TRANSPLANT
  TRANSFER
  GERMINATION
  CLONING
  INSPECTION
  TREATMENT
  STRESS
  EQUIPMENT
  CUSTOM
  FLUSHING
  GENERAL
}

enum LSTIntensity {
  LIGHT
  MODERATE
  INTENSE
}

enum CanopyShape {
  EVEN
  SLOPED
  SUPER_UNEVEN
}

enum Stage {
  SEEDLING
  VEGETATIVE
  FLOWERING
  MOTHER
  CLONE
  DRYING
  CURING
}

enum FieldType {
  TEXT
  NUMBER
  BOOLEAN
  SELECT
  MULTI_SELECT
  DATE
  TIME
  DATETIME
  RATING
  MEASUREMENT
  TEMPERATURE
  HUMIDITY
  COUNTER
  TIMER
  MEDIA
  LOCATION
}

enum NutrientLine {
  JACKS_321
  CUSTOM
}

enum Jacks321Product {
  PART_A_5_12_26
  PART_B_15_0_0_CALCIUM_NITRATE
  PART_C_EPSOM_SALT
  BOOSTER
  FINISH
}

enum WaterSource {
  TAP
  RO
  WELL
  FILTERED
  COLLECTED
  OTHER
}

enum PestType {
  SPIDER_MITES
  THRIPS
  APHIDS
  FUNGUS_GNATS
  WHITEFLIES
  ROOT_APHIDS
  OTHER
}

enum DiseaseType {
  POWDERY_MILDEW
  BOTRYTIS
  ROOT_ROT
  LEAF_SEPTORIA
  FUSARIUM_WILT
  OTHER
}

enum TreatmentMethod {
  FOLIAR_SPRAY
  SOIL_DRENCH
  BENEFICIAL_INSECTS
  ENVIRONMENTAL_ADJUSTMENT
  MANUAL_REMOVAL
  OTHER
}

enum TrainingMethod {
  TOP
  FIM
  LST
  SCROG
  SUPER_CROP
  LOLLIPOP
  OTHER
}
